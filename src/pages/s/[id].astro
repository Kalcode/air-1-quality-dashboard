---
import Layout from "../../components/Layout.astro";
import Dashboard from "../../components/Dashboard.tsx";

const { id } = Astro.params;
const env = (Astro.locals as { runtime: { env: { SHARES: KVNamespace } } }).runtime.env;

let shareData: string | null = null;
let error = false;

try {
  const raw = await env.SHARES.get(`share:${id}`);
  if (raw) {
    shareData = raw;
  } else {
    error = true;
  }
} catch {
  error = true;
}
---

{error ? (
  <Layout title="Link Expired">
    <div style="min-height: 100vh; background: #020617; color: #e2e8f0; display: flex; align-items: center; justify-content: center; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;">
      <div style="text-align: center; max-width: 400px; padding: 20px;">
        <div style="font-size: 48px; margin-bottom: 16px; opacity: 0.4;">‚è±</div>
        <h1 style="font-size: 20px; font-weight: 600; color: #f1f5f9; margin: 0 0 8px;">Link Expired or Not Found</h1>
        <p style="font-size: 13px; color: #64748b; font-family: monospace; margin: 0 0 24px;">
          This shared reading may have expired (links last 30 days) or the URL is incorrect.
        </p>
        <a href="/" style="display: inline-block; padding: 10px 20px; background: #1d4ed8; border-radius: 6px; color: #fff; text-decoration: none; font-size: 13px; font-family: monospace; font-weight: 600;">
          Go to Dashboard
        </a>
      </div>
    </div>
  </Layout>
) : (
  <Layout title="Shared Air Quality Reading">
    <Dashboard client:load shareData={shareData} />
  </Layout>
)}
